<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Cube 시뮬레이션</title>
    <link rel="stylesheet" th:href="@{/css/common.css}">
</head>
<body>

<div th:replace="~{fragments/header :: header}"></div>

<main>
    <!-- 기본 큐브 -->
    <p>기본 큐브 등급: <span id="grade">RARE</span></p>
    <table id="default-table">
        <tr><th>잠재옵션</th></tr>
        <tr><td>-</td></tr>
        <tr><td>-</td></tr>
        <tr><td>-</td></tr>
    </table>

    <!-- 에디셔널 큐브 -->
    <p>에디셔널 큐브 등급: <span id="additional-grade">RARE</span></p>
    <table id="additional-table">
        <tr><th>에디셔널 잠재옵션</th></tr>
        <tr><td>-</td></tr>
        <tr><td>-</td></tr>
        <tr><td>-</td></tr>
    </table>

    <div class="cube-btn-group">
        <button id="default-btn" class="cube-btn">잠재능력 재설정</button>
        &nbsp;&nbsp;&nbsp;
        <button id="additional-btn" class="cube-btn">에디셔널 재설정</button>
    </div>
    <div class="cube-btn-group">
        <button id="reset-btn" class="cube-btn">초기화</button>
    </div>
</main>

<script>
    async function rollCube(url, tableId, gradeId) {
        const res = await fetch(url);
        const data = await res.json();

        // 등급 업데이트
        document.getElementById(gradeId).textContent = data.grade;

        // 옵션 테이블 초기화
        const table = document.getElementById(tableId);
        if (tableId === 'default-table') {
            table.innerHTML = '<tr><th>잠재옵션</th></tr>';
        } else if (tableId === 'additional-table') {
            table.innerHTML = '<tr><th>에디셔널 잠재옵션</th></tr>';
        }

        // 옵션 추가
        data.options.forEach(opt => {
            const row = table.insertRow();
            const cell = row.insertCell();
            cell.textContent = opt.name;
        });
    }

    document.getElementById('default-btn').addEventListener('click', () => {
        rollCube('/cube/use', 'default-table', 'grade');
    });

    document.getElementById('additional-btn').addEventListener('click', () => {
        rollCube('/cube/use/additional', 'additional-table', 'additional-grade');
    });

    document.getElementById('reset-btn').addEventListener('click', async () => {
        const res = await fetch('/cube/reset');
        const data = await res.json();

        // 등급 초기화
        document.getElementById('grade').textContent = data.grade;
        document.getElementById('additional-grade').textContent = data.grade;

        // 테이블 초기화
        ['default-table', 'additional-table'].forEach(id => {
            const table = document.getElementById(id);
            table.innerHTML = id === 'default-table'
                ? '<tr><th>잠재옵션</th></tr>'
                : '<tr><th>에디셔널 잠재옵션</th></tr>';

            for (let i = 0; i < 3; i++) {
                const row = table.insertRow();
                const cell = row.insertCell();
                cell.textContent = '-';
            }
        });
    });

</script>

<div th:replace="~{fragments/footer :: footer}"></div>

</body>
</html>
